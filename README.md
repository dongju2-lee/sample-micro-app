# μμ‹ λ°°λ‹¬ λ§μ΄ν¬λ΅μ„λΉ„μ¤

μ΄ ν”„λ΅μ νΈλ” μμ‹ λ°°λ‹¬ μ„λΉ„μ¤λ¥Ό μ„ν• λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ•„ν‚¤ν…μ² κΈ°λ° μ• ν”λ¦¬μΌ€μ΄μ…μ…λ‹λ‹¤. 
μ„±λ¥ ν…μ¤νΈμ™€ μ¥μ•  μ£Όμ…μ„ μ„ν• κΈ°λ¥λ“¤μ΄ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤.

## μ•„ν‚¤ν…μ²

![μ•„ν‚¤ν…μ²](./architecture.png)

μ΄ μ‹μ¤ν…μ€ λ‹¤μκ³Ό κ°™μ€ λ§μ΄ν¬λ΅μ„λΉ„μ¤λ΅ κµ¬μ„±λμ–΄ μμµλ‹λ‹¤:

1. **User Service**: μ‚¬μ©μ μΈμ¦ λ° κ΄€λ¦¬
2. **Restaurant Service**: μμ‹μ , λ©”λ‰΄ κ΄€λ¦¬ λ° μ¬κ³  κ΄€λ¦¬
3. **Order Service**: μ£Όλ¬Έ μƒμ„± λ° κ΄€λ¦¬

κ° μ„λΉ„μ¤λ” λ…λ¦½μ μΈ λ°μ΄ν„°λ² μ΄μ¤λ¥Ό κ°€μ§€κ³  μμΌλ©°, Redisλ¥Ό μ‚¬μ©ν• μΊμ‹±μ΄ κµ¬ν„λμ–΄ μμµλ‹λ‹¤.

## κΈ°μ  μ¤νƒ

- **λ°±μ—”λ“**: FastAPI (Python)
- **λ°μ΄ν„°λ² μ΄μ¤**: PostgreSQL
- **μΊμ‹±**: Redis
- **μ»¨ν…μ΄λ„ν™”**: Docker, Docker Compose
- **λ΅λ“ λ°Έλ°μ‹±**: NGINX
- **λ¨λ‹ν„°λ§**: Prometheus, Loki, Tempo, Grafana
- **λ¶„μ‚° μ¶”μ **: OpenTelemetry, Tempo

## μ‹μ‘ν•κΈ°

### μ‚¬μ „ μ”κµ¬μ‚¬ν•­

- Docker λ° Docker Composeκ°€ μ„¤μΉλμ–΄ μμ–΄μ•Ό ν•©λ‹λ‹¤.

### μ‚¬μ „ μ„¤μ •

μ‹μ¤ν…μ„ μ‹μ‘ν•κΈ° μ „μ— λ‹¤μ ν•„μ Docker λ¦¬μ†μ¤λ¥Ό μƒμ„±ν•΄μ•Ό ν•©λ‹λ‹¤:

```bash
# λ΅κ·Έ μ €μ¥μ© λ³Όλ¥¨ μƒμ„±
docker volume create sample-micro-app_microservices_logs

# λ§μ΄ν¬λ΅μ„λΉ„μ¤μ™€ λ¨λ‹ν„°λ§ μ‹μ¤ν… κ°„ ν†µμ‹ μ„ μ„ν• λ„¤νΈμ›ν¬ μƒμ„±
docker network create monitoring
```

μ΄ λ¦¬μ†μ¤λ“¤μ€ docker-compose.yml νμΌμ—μ„ μ™Έλ¶€ λ¦¬μ†μ¤λ΅ μ§€μ •λμ–΄ μμ–΄ λ―Έλ¦¬ μƒμ„±ν•΄μ•Ό ν•©λ‹λ‹¤:
- `sample-micro-app_microservices_logs`: λ§μ΄ν¬λ΅μ„λΉ„μ¤μ λ΅κ·Έλ¥Ό μ €μ¥ν•κ³  Promtailμ΄ μμ§‘ν•  μ μλ„λ΅ ν•λ” κ³µμ  λ³Όλ¥¨
- `monitoring`: λ§μ΄ν¬λ΅μ„λΉ„μ¤μ™€ λ¨λ‹ν„°λ§ μΈν”„λΌ(Prometheus, Loki, Tempo, Grafana λ“±) κ°„μ ν†µμ‹ μ„ μ„ν• κ³µμ  λ„¤νΈμ›ν¬

### μ‹¤ν–‰ λ°©λ²•

λ‹¤μ μμ„λ΅ μ‹μ¤ν…μ„ μ‹μ‘ν•μ„Έμ”:

1. λ¨Όμ € λ¨λ‹ν„°λ§ μΈν”„λΌ μ‹μ‘:
```bash
cd infra
docker-compose up -d
```

2. κ·Έ λ‹¤μ λ§μ΄ν¬λ΅μ„λΉ„μ¤ μ• ν”λ¦¬μΌ€μ΄μ… μ‹μ‘:
```bash
cd ..  # ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬λ΅ μ΄λ™
docker-compose up -d
```

λ¨λ“  μ„λΉ„μ¤κ°€ μ •μƒμ μΌλ΅ μ‹μ‘λλ©΄ λ‹¤μ ν¬νΈλ΅ κ° μ„λΉ„μ¤μ— μ ‘κ·Όν•  μ μμµλ‹λ‹¤:

- User Service: http://localhost:8001
- Restaurant Service: http://localhost:8002
- Order Service: http://localhost:8003
- API Gateway: http://localhost:80
- Grafana (λ¨λ‹ν„°λ§): http://localhost:3000 (admin / password)
- Prometheus (λ©”νΈλ¦­): http://localhost:9090
- Tempo (λ¶„μ‚° μ¶”μ ): http://localhost:3200

### API λ¬Έμ„ (Swagger UI)

κ° μ„λΉ„μ¤λ” Swagger UIλ¥Ό ν†µν•΄ μƒμ„Έν• API λ¬Έμ„λ¥Ό μ κ³µν•©λ‹λ‹¤. μ΄ λ¬Έμ„λ¥Ό ν†µν•΄ κ° API μ—”λ“ν¬μΈνΈμ κΈ°λ¥, νλΌλ―Έν„°, μ‘λ‹µ ν•μ‹μ„ ν™•μΈν•κ³  μ§μ ‘ ν…μ¤νΈν•΄λ³Ό μ μμµλ‹λ‹¤.

- User Service: http://localhost:8001/docs
- Restaurant Service: http://localhost:8002/docs
- Order Service: http://localhost:8003/docs

#### Swagger UI μ‚¬μ©λ²•

1. **API μ—”λ“ν¬μΈνΈ νƒμƒ‰**: κ° μ„λΉ„μ¤μ API μ—”λ“ν¬μΈνΈκ°€ κΈ°λ¥λ³„λ΅ κ·Έλ£Ήν™”λμ–΄ μμµλ‹λ‹¤.
2. **API μƒμ„Έ μ •λ³΄ ν™•μΈ**: κ° μ—”λ“ν¬μΈνΈλ¥Ό ν΄λ¦­ν•λ©΄ μƒμ„Έ μ„¤λ…, μ”μ²­ νλΌλ―Έν„°, μ‘λ‹µ ν•μ‹μ„ λ³Ό μ μμµλ‹λ‹¤.
3. **API ν…μ¤νΈ**: "Try it out" λ²„νΌμ„ ν΄λ¦­ν•μ—¬ μ§μ ‘ APIλ¥Ό ν…μ¤νΈν•  μ μμµλ‹λ‹¤.
4. **μ”μ²­ μμ‹**: κ° APIλ³„λ΅ μ”μ²­ μμ‹κ°€ μ κ³µλμ–΄ μ–΄λ–¤ ν•μ‹μΌλ΅ μ”μ²­ν•΄μ•Ό ν•λ”μ§€ νμ•…ν•  μ μμµλ‹λ‹¤.
5. **μ‘λ‹µ μμ‹**: μμƒλλ” μ‘λ‹µ ν•μ‹κ³Ό μƒνƒ μ½”λ“κ°€ μμ„Έν λ¬Έμ„ν™”λμ–΄ μμµλ‹λ‹¤.

#### ν–¥μƒλ API λ¬Έμ„ κΈ°λ¥

Swagger UIλ” λ‹¤μκ³Ό κ°™μ€ ν–¥μƒλ κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤:

- **μ§κ΄€μ μΈ μ•„μ΄μ½**: κΈ°λ¥λ³„ μΉ΄ν…κ³ λ¦¬μ— μ•„μ΄μ½μ΄ μ¶”κ°€λμ–΄ μ‹κ°μ μΌλ΅ κµ¬λ¶„μ΄ μ‰½μµλ‹λ‹¤.
- **μ”μ•½ μ •λ³΄ κ°•ν™”**: API μ΄λ¦„ μ•μ— ν‘μ‹(π‘‰)κ°€ μ¶”κ°€λμ–΄ API λ©μ μ„ ν•λμ— νμ•…ν•  μ μμµλ‹λ‹¤.
- **μƒμ„Έ μ„¤λ… κ°μ„ **: APIλ¥Ό λ§μ°μ¤ μ¤λ²„ν•λ©΄ κ°•μ΅°λ μ”μ•½ μ„¤λ…κ³Ό ν•¨κ» μƒμ„Έν• κ°€μ΄λ“λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤.
- **API κ·Έλ£Ήν™”**: κ΄€λ ¨ APIλ“¤μ΄ λ…Όλ¦¬μ μΈ κ·Έλ£ΉμΌλ΅ μ •λ¦¬λμ–΄ μμ–΄ ν•„μ”ν• APIλ¥Ό μ‰½κ² μ°Ύμ„ μ μμµλ‹λ‹¤.

#### ReDoc λ¬Έμ„

λ” κΉ”λ”ν• ν•νƒμ, μ½κΈ° μ „μ© API λ¬Έμ„κ°€ ν•„μ”ν•λ‹¤λ©΄ ReDoc λ¬Έμ„λ„ μ κ³µλ©λ‹λ‹¤:

- User Service: http://localhost:8001/redoc
- Restaurant Service: http://localhost:8002/redoc
- Order Service: http://localhost:8003/redoc

## API μ—”λ“ν¬μΈνΈ

### User Service (8001 ν¬νΈ)

| μ—”λ“ν¬μΈνΈ | λ©”μ†λ“ | κΈ°λ¥ | μ¥μ•  μ£Όμ…μ© νλΌλ―Έν„° |
|------------|--------|------|----------------------|
| /signup | POST | νμ› κ°€μ… | - |
| /login | POST | JWT ν† ν° λ°κΈ‰ | - |
| /users/{id} | GET | μ‚¬μ©μ μ •λ³΄ μ΅°ν | - |
| /validate | POST | μ£Όλ¬Έ μ‹ μ ν¨ μ‚¬μ©μ ν™•μΈ | ?delay=2000 (ms λ‹¨μ„ μ§€μ—°) |
| /chaos/delay | POST | λ¨λ“  APIμ— μΈμ„μ  μ§€μ—° μ„¤μ • | { "delay_ms": 1500 } |
| /chaos/error | POST | 50% ν™•λ¥ λ΅ 500 μ—λ¬ λ°μƒ | { "enable": true } |

### Restaurant Service (8002 ν¬νΈ)

| μ—”λ“ν¬μΈνΈ | λ©”μ†λ“ | κΈ°λ¥ | μΊμ‹±/λ™μ‹μ„± μ μ–΄ |
|------------|--------|------|------------------|
| /menus | GET | μ „μ²΄ λ©”λ‰΄ μ΅°ν | Redis μΊμ‹(10μ΄) |
| /menus/{id} | GET | λ‹¨μΌ λ©”λ‰΄ μƒμ„Έ μ΅°ν | Redis μΊμ‹(30μ΄) |
| /inventory/{menuId} | PUT | μ¬κ³  κ°μ† (λ™μ‹μ„± μ μ–΄ μ μ©) | Pessimistic Lock |
| /chaos/inventory_delay | POST | μ¬κ³  μ—…λ°μ΄νΈ μ§€μ—° μ„¤μ • | { "delay_ms": 3000 } |

### Order Service (8003 ν¬νΈ)

| μ—”λ“ν¬μΈνΈ | λ©”μ†λ“ | κΈ°λ¥ | μ™Έλ¶€ νΈμ¶ μμ΅΄μ„± |
|------------|--------|------|------------------|
| /orders | POST | μ£Όλ¬Έ μƒμ„± | User Service β†’ Restaurant Service β†’ Redis |
| /orders/{id} | GET | μ£Όλ¬Έ μƒνƒ μ΅°ν | - |
| /orders/{id}/cancel | POST | μ£Όλ¬Έ μ·¨μ† | Restaurant Service μ¬κ³  λ³µκµ¬ |
| /chaos/payment_fail | POST | κ²°μ  μ‹¤ν¨μ¨ μ„¤μ • | { "fail_percent": 30 } |

## λ¶€ν• ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

λ§μ΄ν¬λ΅μ„λΉ„μ¤ ν™κ²½μ—μ„ μ‹μ¤ν…μ μ„±λ¥κ³Ό λ³µμ›λ ¥μ„ ν…μ¤νΈν•κΈ° μ„ν• ν¨κ³Όμ μΈ μ‹λ‚λ¦¬μ¤λ“¤μ…λ‹λ‹¤.

### 1. μΉ΄μ¤μ¤ μ—”μ§€λ‹μ–΄λ§ ν…μ¤νΈ

κ²°μ  μ‹¤ν¨μ¨μ„ μ΅°μ •ν•μ—¬ λ΅¤λ°± κΈ°λ¥κ³Ό μ¤λ¥ μ²λ¦¬ λ©”μ»¤λ‹μ¦μ„ ν…μ¤νΈν•©λ‹λ‹¤:

```bash
# 30%μ ν™•λ¥ λ΅ κ²°μ κ°€ μ‹¤ν¨ν•λ„λ΅ μ„¤μ •
curl -X POST http://localhost:8003/chaos/payment_fail -H "Content-Type: application/json" -d '{"fail_percent": 30}'
```

μ΄ μ„¤μ • ν›„ μ£Όλ¬Έμ„ μƒμ„±ν•λ©΄ 30%μ ν™•λ¥ λ΅ κ²°μ κ°€ μ‹¤ν¨ν•κ³  μ‹μ¤ν…μ΄ μλ™μΌλ΅ μ¬κ³ λ¥Ό λ³µκµ¬ν•λ©° μ£Όλ¬Έ μƒνƒλ¥Ό 'FAILED'λ΅ λ³€κ²½ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄:
- μ‹¤ν¨ μ²λ¦¬μ μ •ν™•μ„± κ²€μ¦
- μ¬κ³  μλ™ λ³µκµ¬ λ©”μ»¤λ‹μ¦ ν…μ¤νΈ
- νΈλμ­μ… λ΅¤λ°±μ μ•μ •μ„± ν™•μΈ

### 2. λ™μ‹ μ£Όλ¬Έ λ¶€ν• ν…μ¤νΈ

μ—¬λ¬ μ‚¬μ©μκ°€ λ™μ‹μ— κ°™μ€ λ©”λ‰΄μ— μ£Όλ¬Έν•  λ•μ λ™μ‹μ„± λ¬Έμ λ¥Ό ν…μ¤νΈν•©λ‹λ‹¤:

```bash
# JMeter λλ” λ‹¤λ¥Έ λ¶€ν• ν…μ¤νΈ λ„κµ¬λ¥Ό μ΄μ©ν•΄ λ™μ‹μ— μ—¬λ¬ μ£Όλ¬Έ μƒμ„±
# POST /orders μ—”λ“ν¬μΈνΈμ— λ‹¤μμ λ™μ‹ μ”μ²­
```

μ΄ ν…μ¤νΈλ”:
- λ™μ‹μ„± μ μ–΄ λ©”μ»¤λ‹μ¦μ ν¨μ¨μ„±
- μ¬κ³  κ΄€λ¦¬μ μΌκ΄€μ„±
- λ°μ΄ν„°λ² μ΄μ¤ λ½ μ „λµμ μ„±λ¥
μ„ κ²€μ¦ν•λ” λ° μ μ©ν•©λ‹λ‹¤.

### 3. μ·¨μ†-μ¬μ£Όλ¬Έ μ‹λ‚λ¦¬μ¤

μ£Όλ¬Έ μƒμ„± ν›„ μ·¨μ†ν•κ³  λ‹¤μ‹ μ£Όλ¬Έν•λ” ν¨ν„΄μ„ λ°λ³µν•μ—¬ μ¬κ³  κ΄€λ¦¬μ μΌκ΄€μ„±μ„ ν…μ¤νΈν•©λ‹λ‹¤:

```bash
# 1. μ£Όλ¬Έ μƒμ„±
curl -X POST http://localhost:8003/orders -H "Authorization: Bearer {ν† ν°}" -H "Content-Type: application/json" -d '{
  "items": [{"menu_id": 1, "quantity": 2}],
  "address": "μ„μΈμ‹ κ°•λ‚¨κµ¬ 123-45",
  "phone": "010-1234-5678"
}'

# 2. μ£Όλ¬Έ ID ν™•μΈ ν›„ μ·¨μ†
curl -X POST http://localhost:8003/orders/{order_id}/cancel

# 3. λ™μΌν• λ©”λ‰΄λ΅ λ‹¤μ‹ μ£Όλ¬Έ
```

μ΄ μ‹λ‚λ¦¬μ¤λ”:
- μ¬κ³  λ³µκµ¬ λ©”μ»¤λ‹μ¦μ μ •ν™•μ„±
- μ·¨μ†-μ¬μ£Όλ¬Έ κ³Όμ •μ—μ„μ μΌκ΄€μ„±
- μƒνƒ λ³€κ²½μ μ‹ λΆ°μ„±
μ„ κ²€μ¦ν•©λ‹λ‹¤.

### 4. μΊμ‹± ν¨κ³Ό ν…μ¤νΈ

Redis μΊμ‹±μ΄ μ–΄λ–»κ² μ„±λ¥μ„ ν–¥μƒμ‹ν‚¤λ”μ§€ κ²€μ¦ν•©λ‹λ‹¤:

```bash
# 1. νΉμ • μ£Όλ¬Έ μ΅°ν (μΊμ‹ λ―Έμ¤, DB μ΅°ν)
time curl http://localhost:8003/orders/{order_id}

# 2. λ™μΌν• μ£Όλ¬Έ λ‹¤μ‹ μ΅°ν (μΊμ‹ ννΈ)
time curl http://localhost:8003/orders/{order_id}

# 3. 5λ¶„ ν›„ λ‹¤μ‹ μ΅°ν (μΊμ‹ λ§λ£, DB μ΅°ν)
```

μ‘λ‹µ μ‹κ°„μ„ λΉ„κµν•μ—¬:
- μΊμ‹ ν¨μ¨μ„± μΈ΅μ •
- μΊμ‹ λ§λ£ μ •μ±… κ²€μ¦
- μ‹μ¤ν… μ„±λ¥ ν–¥μƒ μ •λ„ ν™•μΈ

### 5. λ§μ΄ν¬λ΅μ„λΉ„μ¤ κ°„ ν†µμ‹  ν…μ¤νΈ

μ„λΉ„μ¤ κ°„ ν†µμ‹ μ΄ λ°μƒν•λ” μ „μ²΄ νλ¦„μ„ ν…μ¤νΈν•©λ‹λ‹¤:

```bash
# 1. λ΅κ·ΈμΈν•μ—¬ ν† ν° νλ“
curl -X POST http://localhost:8001/login -H "Content-Type: application/json" -d '{"username": "user", "password": "pass"}'

# 2. νλ“ν• ν† ν°μΌλ΅ μ£Όλ¬Έ μƒμ„±
curl -X POST http://localhost:8003/orders -H "Authorization: Bearer {ν† ν°}" -H "Content-Type: application/json" -d '{
  "items": [{"menu_id": 1, "quantity": 2}],
  "address": "μ„μΈμ‹ κ°•λ‚¨κµ¬ 123-45",
  "phone": "010-1234-5678"
}'
```

μ΄ ν…μ¤νΈλ΅:
- μ„λΉ„μ¤ κ°„ μΈμ¦ μ²΄κ³„ κ²€μ¦
- λ¶„μ‚° νΈλμ­μ…μ μΌκ΄€μ„± ν™•μΈ
- μ „μ²΄ μ‹μ¤ν… ν†µν•©μ κ²¬κ³ μ„± ν…μ¤νΈ

### 6. μ§€μ—° μ£Όμ… ν…μ¤νΈ

μ„λΉ„μ¤μ— μΈμ„μ  μ§€μ—°μ„ μ¶”κ°€ν•μ—¬ νƒ€μ„μ•„μ›ƒ μ²λ¦¬μ™€ νλ³µλ ¥μ„ ν…μ¤νΈν•©λ‹λ‹¤:

```bash
# μ‚¬μ©μ μ„λΉ„μ¤μ— 2μ΄ μ§€μ—° μ„¤μ •
curl -X POST http://localhost:8001/chaos/delay -H "Content-Type: application/json" -d '{"delay_ms": 2000}'

# μ§€μ—° μ„¤μ • ν›„ μ£Όλ¬Έ μƒμ„± μ‹λ„
```

μ΄λ¥Ό ν†µν•΄:
- νƒ€μ„μ•„μ›ƒ μ²λ¦¬ λ©”μ»¤λ‹μ¦ κ²€μ¦
- μ„λΉ„μ¤ μ§€μ—° μ‹ μ‚¬μ©μ κ²½ν— μΈ΅μ •
- μ‹μ¤ν…μ νλ³µ νƒ„λ ¥μ„± ν™•μΈ

## λ¶€ν• ν…μ¤νΈ λ„κµ¬ κ¶μ¥

μ„ μ‹λ‚λ¦¬μ¤λ¥Ό ν¨κ³Όμ μΌλ΅ μ‹¤ν–‰ν•κΈ° μ„ν• λ„κµ¬ κ¶μ¥μ‚¬ν•­:

1. **Apache JMeter**: λ³µμ΅ν• μ‹λ‚λ¦¬μ¤μ™€ λ™μ‹ μ‚¬μ©μ μ‹λ®¬λ μ΄μ…μ— μ ν•©
2. **Locust**: Python κΈ°λ°μΌλ΅ μ‚¬μ©μ ν–‰λ™ ν¨ν„΄μ„ μ •μν•κΈ° μ‰¬μ›€
3. **k6**: κ°λ°μ μΉν™”μ μΈ JavaScript κΈ°λ° λ¶€ν• ν…μ¤νΈ λ„κµ¬
4. **Shell μ¤ν¬λ¦½νΈ**: κ°„λ‹¨ν• ν…μ¤νΈλ¥Ό μ„ν• curl λ…λ Ή ν™μ©

## ν…μ¤νΈ μ‹λ‚λ¦¬μ¤ κ°€μ΄λ“

### 1. κΈ°λ³Έ μ‚¬μ©μ νλ¦„

1. **νμ› κ°€μ…**: User Serviceμ `/signup` APIλ¥Ό μ‚¬μ©ν•΄ κ³„μ • μƒμ„±
2. **λ΅κ·ΈμΈ**: `/login` APIλ΅ JWT ν† ν° λ°κΈ‰
3. **λ©”λ‰΄ λ©λ΅ μ΅°ν**: Restaurant Serviceμ `/menus` APIλ΅ λ©”λ‰΄ ν™•μΈ
4. **μ£Όλ¬Έ μƒμ„±**: Order Serviceμ `/orders` APIλ΅ μ£Όλ¬Έ (ν† ν° ν•„μ”)
5. **μ£Όλ¬Έ μƒνƒ ν™•μΈ**: `/orders/{id}` APIλ΅ μ£Όλ¬Έ μƒνƒ ν™•μΈ
6. **μ£Όλ¬Έ μ·¨μ†**: ν•„μ”ν• κ²½μ° `/orders/{id}/cancel` APIλ΅ μ£Όλ¬Έ μ·¨μ†

### 2. μ„±λ¥ ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

1. **μΊμ‹± ν¨κ³Ό μΈ΅μ •**: 
   - Restaurant Serviceμ `/menus` API λ°λ³µ νΈμ¶ν•μ—¬ μ²« νΈμ¶κ³Ό μ΄ν›„ νΈμ¶μ μ‘λ‹µ μ‹κ°„ λΉ„κµ
   - JMeter λ“±μ λ„κµ¬λ΅ μ‘λ‹µ μ‹κ°„ μΈ΅μ •

2. **λ™μ‹μ„± μ μ–΄ ν…μ¤νΈ**:
   - μ—¬λ¬ ν΄λΌμ΄μ–ΈνΈμ—μ„ λ™μ‹μ— νΉμ • λ©”λ‰΄ μ£Όλ¬Έ
   - μ¬κ³ κ°€ μ •ν™•ν κ°μ†ν•λ”μ§€ ν™•μΈ

## μ„±λ¥ ν…μ¤νΈ λ° μ¥μ•  μ£Όμ…

μ΄ μ‹μ¤ν…μ€ λ‹¤μ–‘ν• μΉ΄μ¤μ¤ μ—”μ§€λ‹μ–΄λ§ κΈ°λ¥μ„ μ κ³µν•©λ‹λ‹¤:

1. **μΈμ„μ  μ§€μ—° μ„¤μ •**: κ° μ„λΉ„μ¤μ—μ„ νΉμ • API νΈμ¶μ— μ§€μ—°μ„ μ¶”κ°€ν•  μ μμµλ‹λ‹¤.
2. **μ—λ¬ μ£Όμ…**: μΌμ • ν™•λ¥ λ΅ μ—λ¬λ¥Ό λ°μƒμ‹μΌ μ‹μ¤ν… λ³µμ›λ ¥μ„ ν…μ¤νΈν•  μ μμµλ‹λ‹¤.
3. **κ²°μ  μ‹¤ν¨ μ‹λ®¬λ μ΄μ…**: μ£Όλ¬Έ μ„λΉ„μ¤μ—μ„ κ²°μ  μ‹¤ν¨μ¨μ„ μ΅°μ •ν•μ—¬ λ΅¤λ°±μ„ ν…μ¤νΈν•  μ μμµλ‹λ‹¤.

### μ„±λ¥ ν…μ¤νΈ μμ 

```bash
# 1. User Serviceμ— 2μ΄ μ§€μ—° μ„¤μ •
curl -X POST http://localhost:8001/chaos/delay -H "Content-Type: application/json" -d '{"delay_ms": 2000}'

# 2. Restaurant Serviceμ μ¬κ³  μ—…λ°μ΄νΈμ— 3μ΄ μ§€μ—° μ„¤μ •
curl -X POST http://localhost:8002/chaos/inventory_delay -H "Content-Type: application/json" -d '{"delay_ms": 3000}'

# 3. Order Serviceμ—μ„ 30% ν™•λ¥ λ΅ κ²°μ  μ‹¤ν¨ μ„¤μ •
curl -X POST http://localhost:8003/chaos/payment_fail -H "Content-Type: application/json" -d '{"fail_percent": 30}'

# 4. User Serviceμ—μ„ 50% ν™•λ¥ λ΅ 500 μ—λ¬ λ°μƒ
curl -X POST http://localhost:8001/chaos/error -H "Content-Type: application/json" -d '{"enable": true}'
```

## μΊμ‹± μ „λµ

- Restaurant Serviceμ λ©”λ‰΄ μ΅°νλ” Redisλ¥Ό ν†µν•΄ μΊμ‹±λ©λ‹λ‹¤ (μ „μ²΄ λ©”λ‰΄ 10μ΄, λ‹¨μΌ λ©”λ‰΄ 30μ΄)
- Order Serviceμ μ£Όλ¬Έ μ •λ³΄λ” μ΅°ν μ‹ 5λ¶„ λ™μ• μΊμ‹±λ©λ‹λ‹¤

## λ™μ‹μ„± μ μ–΄

- Restaurant Serviceμ μ¬κ³  μ—…λ°μ΄νΈλ” λΉ„κ΄€μ  λ½(Pessimistic Lock)μ„ μ‚¬μ©ν•μ—¬ λ™μ‹μ„± λ¬Έμ λ¥Ό ν•΄κ²°ν•©λ‹λ‹¤
- μ΄λ¥Ό ν†µν•΄ λ™μ‹μ— μ—¬λ¬ μ£Όλ¬Έμ΄ κ°™μ€ λ©”λ‰΄λ¥Ό μ£Όλ¬Έν•  λ• λ°μƒν•  μ μλ” μ¬κ³  λ¶μΌμΉ λ¬Έμ λ¥Ό λ°©μ§€ν•©λ‹λ‹¤

## νΈλ¬λΈ”μν…

### μ„λΉ„μ¤κ°€ μ‹μ‘λμ§€ μ•λ” κ²½μ°

```bash
# λ΅κ·Έ ν™•μΈ
docker-compose logs -f

# νΉμ • μ„λΉ„μ¤ λ΅κ·Έλ§ ν™•μΈ
docker-compose logs -f user-service
```

### λ°μ΄ν„° μ΄κΈ°ν™”

```bash
# λ¨λ“  μ»¨ν…μ΄λ„μ™€ λ³Όλ¥¨ μ‚­μ 
docker-compose down -v

# λ‹¤μ‹ μ‹μ‘
docker-compose up -d
```

## λ¶„μ‚° μ¶”μ  (OpenTelemetry)

μ΄ ν”„λ΅μ νΈλ” OpenTelemetryλ¥Ό μ‚¬μ©ν•μ—¬ λ§μ΄ν¬λ΅μ„λΉ„μ¤ κ°„ νΈλ μ΄μ¤λ¥Ό μμ§‘ν•κ³  κ°€μ‹ν™”ν•©λ‹λ‹¤. μ΄λ¥Ό ν†µν•΄ μ„λΉ„μ¤ κ°„ μ”μ²­ νλ¦„μ„ μ¶”μ ν•κ³  μ„±λ¥ λ³‘λ© ν„μƒμ„ μ‹λ³„ν•  μ μμµλ‹λ‹¤.

### OpenTelemetry κµ¬μ„±

κ° λ§μ΄ν¬λ΅μ„λΉ„μ¤λ” λ‹¤μκ³Ό κ°™μ€ λ°©μ‹μΌλ΅ OpenTelemetryκ°€ μ„¤μ •λμ–΄ μμµλ‹λ‹¤:

1. **Zero-code μλ™ κ³„μΈ΅**: κ° μ„λΉ„μ¤μ Dockerfileμ— λ‹¤μ ν•­λ©μ΄ ν¬ν•¨λμ–΄ μμµλ‹λ‹¤:
   ```docker
   # OpenTelemetry κ΄€λ ¨ ν¨ν‚¤μ§€ μ„¤μΉ
   RUN pip install opentelemetry-distro opentelemetry-exporter-otlp
   RUN opentelemetry-bootstrap -a install

   # OpenTelemetry μλ™κ³„μΈ΅ μ‹¤ν–‰ 
   CMD ["opentelemetry-instrument", "--service_name", "μ„λΉ„μ¤λ…", "uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
   ```

2. **ν™κ²½ λ³€μ μ„¤μ •**: κ° μ„λΉ„μ¤μ— λ‹¤μ ν™κ²½ λ³€μκ°€ μ„¤μ •λμ–΄ μμµλ‹λ‹¤:
   ```
   - OTEL_SERVICE_NAME=μ„λΉ„μ¤λ…
   - OTEL_EXPORTER_OTLP_ENDPOINT=http://host.docker.internal:4317
   - OTEL_RESOURCE_ATTRIBUTES=service.name=μ„λΉ„μ¤λ…,service.namespace=food-delivery
   - OTEL_TRACES_EXPORTER=otlp
   - OTEL_METRICS_EXPORTER=otlp
   ```

### νΈλ μ΄μ¤ ν™•μΈ λ°©λ²•

1. μ›Ή λΈλΌμ°μ €μ—μ„ Grafanaμ— μ ‘μ†ν•©λ‹λ‹¤: http://localhost:3000 (μ‚¬μ©μ μ΄λ¦„: admin, λΉ„λ°€λ²νΈ: password)
2. μ™Όμ½ λ©”λ‰΄μ—μ„ Explore μ•„μ΄μ½μ„ ν΄λ¦­ν•©λ‹λ‹¤.
3. λ°μ΄ν„° μ†μ¤λ΅ "Tempo"λ¥Ό μ„ νƒν•©λ‹λ‹¤.
4. μ„λΉ„μ¤λ¥Ό νΈμ¶ν• ν›„, νΈλ μ΄μ¤ λ©λ΅μ΄ ν‘μ‹λ©λ‹λ‹¤.
5. νΉμ • νΈλ μ΄μ¤λ¥Ό ν΄λ¦­ν•μ—¬ μƒμ„Έ μ •λ³΄λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤.

### νΈλ μ΄μ¤ λ°μ΄ν„° μƒμ„±

νΈλ μ΄μ¤ λ°μ΄ν„°λ¥Ό μƒμ„±ν•λ ¤λ©΄ λ§μ΄ν¬λ΅μ„λΉ„μ¤ APIλ¥Ό νΈμ¶ν•΄μ•Ό ν•©λ‹λ‹¤. μλ¥Ό λ“¤μ–΄:

```bash
# μ‚¬μ©μ λ΅κ·ΈμΈ
curl -X POST http://localhost:8001/login -H "Content-Type: application/json" -d '{"username": "user", "password": "pass"}'

# λ©”λ‰΄ μ΅°ν
curl -X GET http://localhost:8002/menus

# μ£Όλ¬Έ μƒμ„±
curl -X POST http://localhost:8003/orders -H "Authorization: Bearer {ν† ν°}" -H "Content-Type: application/json" -d '{
  "items": [{"menu_id": 1, "quantity": 2}],
  "address": "μ„μΈμ‹ κ°•λ‚¨κµ¬ 123-45",
  "phone": "010-1234-5678"
}'
```

μ΄λ¬ν• API νΈμ¶μ€ λ§μ΄ν¬λ΅μ„λΉ„μ¤ κ°„μ ν†µμ‹ μ„ νΈλ¦¬κ±°ν•κ³  κ° μ„λΉ„μ¤μ—μ„ νΈλ μ΄μ¤ λ°μ΄ν„°κ°€ μƒμ„±λ©λ‹λ‹¤.

## νΈλ¬λΈ”μν…

### OpenTelemetry κ΄€λ ¨ λ¬Έμ 

#### νΈλ μ΄μ¤ λ°μ΄ν„°κ°€ λ³΄μ΄μ§€ μ•λ” κ²½μ°

1. Tempo μ„λΉ„μ¤κ°€ μ‹¤ν–‰ μ¤‘μΈμ§€ ν™•μΈν•©λ‹λ‹¤:
   ```bash
   docker ps | grep tempo
   ```

2. λ§μ΄ν¬λ΅μ„λΉ„μ¤ λ΅κ·Έμ—μ„ OTLP κ΄€λ ¨ μ¤λ¥λ¥Ό ν™•μΈν•©λ‹λ‹¤:
   ```bash
   docker-compose logs user-service | grep -i otlp
   ```

3. νΈμ¤νΈ μ—°κ²° λ¬Έμ κ°€ λ°μƒν•λ” κ²½μ°, ν™κ²½ λ³€μ μ„¤μ •μ„ ν™•μΈν•©λ‹λ‹¤:
   ```bash
   # docker-compose.yml νμΌμ—μ„ OTEL_EXPORTER_OTLP_ENDPOINT κ°’μ„ ν™•μΈ
   ```

#### μ„λΉ„μ¤κ°€ μ‹μ‘λμ§€ μ•λ” κ²½μ°

```bash
# λ΅κ·Έ ν™•μΈ
docker-compose logs -f

# νΉμ • μ„λΉ„μ¤ λ΅κ·Έλ§ ν™•μΈ
docker-compose logs -f user-service
```

### λ°μ΄ν„° μ΄κΈ°ν™”

```bash
# λ¨λ“  μ»¨ν…μ΄λ„μ™€ λ³Όλ¥¨ μ‚­μ 
docker-compose down -v

# λ‹¤μ‹ μ‹μ‘
docker-compose up -d
```
