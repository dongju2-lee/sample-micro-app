# k6 로드 테스트 가이드

이 디렉토리에는 마이크로서비스 아키텍처의 부하 테스트 및 성능 테스트를 위한 k6 스크립트가 포함되어 있습니다.

## 개요

k6는 부하 테스트 및 성능 테스트를 위한 현대적인 도구로, JavaScript로 테스트 시나리오를 작성할 수 있습니다. 이 프로젝트에서는 도커를 통해 k6를 실행합니다.

## 테스트 시나리오

이 디렉토리에는 다음과 같은 테스트 시나리오가 포함되어 있습니다:

1. **카오스 엔지니어링 테스트** (01-chaos-engineering-test.js)
   - 결제 실패와 같은 오류 상황에서 시스템의 동작을 테스트합니다.
   - 30%의 결제 실패 확률을 시뮬레이션합니다.

2. **동시 주문 테스트** (02-concurrent-orders-test.js)
   - 동시에 여러 주문이 들어오는 상황을 시뮬레이션합니다.
   - 초당 1개에서 최대 30개까지 주문량을 증가시킵니다.

3. **주문 취소 및 재주문 테스트** (03-cancel-reorder-test.js)
   - 사용자가 주문을 취소하고 다시 주문하는 시나리오를 테스트합니다.
   - 시스템 복원력과 상태 관리 능력을 평가합니다.

4. **캐싱 효과 테스트** (04-caching-effect-test.js)
   - 캐싱의 효과를 측정하는 테스트입니다.
   - 첫 번째 호출과 캐시된 후속 호출의 응답 시간을 비교합니다.

5. **마이크로서비스 통신 테스트** (05-microservice-communication-test.js)
   - 마이크로서비스 간 통신 성능과 신뢰성을 테스트합니다.
   - 각 서비스 간 통신 지연 시간 및 성공률을 측정합니다.

## 실행 방법

### 사전 요구사항

- Docker가 설치되어 있어야 합니다.
- 마이크로서비스가 실행 중이어야 합니다 (`docker-compose up -d`로 실행).

### 테스트 실행

제공된 쉘 스크립트를 사용하여 테스트를 실행할 수 있습니다:

```bash
# 모든 테스트 실행
./run-tests.sh all

# 특정 테스트 실행
./run-tests.sh 01-chaos-engineering-test.js
```

### 결과 해석

각 테스트 실행 후, 결과는 JSON 형식으로 저장됩니다. 결과 파일명은 `results-{테스트명}.json` 형식입니다.

테스트 결과에서 주요 지표:

- **http_req_duration**: HTTP 요청의 총 시간 (밀리초)
- **http_req_failed**: 실패한 HTTP 요청의 비율
- **iterations**: 완료된 반복 횟수
- **vus**: 가상 사용자 수
- 각 테스트 시나리오별 사용자 정의 메트릭 (예: `service_calls_success_rate`, `order_success_count` 등)

## 테스트 시나리오 사용자 정의

각 테스트 스크립트는 필요에 따라 수정할 수 있습니다:

- `options` 객체에서 가상 사용자 수, 테스트 지속 시간, 임계값 등을 조정
- 요청 URL, 페이로드, 헤더 등을 변경
- 사용자 정의 메트릭 추가 또는 변경

## 문제 해결

- 테스트 실행 시 오류가 발생하면 시스템의 로그를 확인하세요: `docker-compose logs`
- 네트워크 연결 문제가 있는 경우 도커 네트워크 설정을 확인하세요
- 스크립트의 `console.log` 메시지는 디버깅에 도움이 됩니다

## 참고 자료

- [k6 공식 문서](https://k6.io/docs/)
- [Grafana k6 Docker 이미지](https://hub.docker.com/r/grafana/k6)
- [k6 API 참조](https://k6.io/docs/javascript-api/) 